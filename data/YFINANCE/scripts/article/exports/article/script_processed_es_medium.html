<!DOCTYPE html>
<html>
<head>
    <title>Procesando reportes financieros anuales sobre m칰ltiples activos en Python</title>
</head>
<body>
    <h2>Te explicamos c칩mo procesar m칰ltiples activos financieros para agregarlos a un reporte que destaque el rendimiento anual de cada activo.</h2>
    <p>Si comparamos el rendimiento de activos financieros como Bitcoin,
ETFs y acciones, 쯖u치l fue el activo con mayor rentabilidad, desde el
a침o 2010?</p>
<figure>
<img src="https://images.datons.ai/C-BILELLO-1/D_asset_performance.png" alt="Comparaci칩n de rendimiento anual de diferentes activos financieros desde 2010">
<figcaption>
F1. Rendimiento anual de activos financieros desde 2010
</figcaption>
</figure>
<p>En este tutorial, te explicamos c칩mo descargar, procesar y reportar
el rendimiento de activos financieros usando Python.</p>
<p>El reporte est치 inspirado los <a
href="https://twitter.com/charliebilello/status/1643699214914822144">an치lisis
de Charlie Bilello</a>.</p>
<blockquote>
<p>Aprende a programar m치s casos pr치cticos en <a
href="https://datons.ai">datons</a></p>
</blockquote>
<h1 id="data">Data</h1>
<p>Definimos la lista de tickers de los activos a analizar.</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>tickers <span class="op">=</span> [<span class="st">&#39;BTC-USD&#39;</span>, <span class="st">&#39;QQQ&#39;</span>, <span class="st">&#39;IWF&#39;</span>, <span class="st">&#39;SPY&#39;</span>, ...]</span></code></pre></div>
<p>Descargamos movimientos diarios de precios hist칩ricos usando la
librer칤a <code>yfinance</code>, que descarga datos de Yahoo Finance.</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> yfinance <span class="im">as</span> yf</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> yf.download(tickers)</span></code></pre></div>
<figure>
<img src="https://images.datons.ai/C-BILELLO-1/D_hist.png" alt="Gr치fico de precios hist칩ricos diarios para Bitcoin, ETFs y acciones">
<figcaption>
F2. Precios hist칩ricos diarios de activos financieros
</figcaption>
</figure>
<h1 id="preguntas">Preguntas</h1>
<ol type="1">
<li>쮺칩mo descargar datos hist칩ricos de precios de m칰ltiples activos
financieros?</li>
<li>쮺칩mo calcular el retorno acumulado anual de cada activo?</li>
<li>쯇or qu칠 es necesario agrupar los datos para tener c치lculos
acumulados?</li>
<li>쮺칩mo seleccionar el 칰ltimo d칤a de retorno acumulado en cada
a침o?</li>
<li>쮺칩mo identificar los valores m치ximos y m칤nimos de retorno en cada
a침o?</li>
<li>쮺칩mo calcular el porcentaje de retornos positivos para cada
activo?</li>
</ol>
<h1 id="metodolog칤a">Metodolog칤a</h1>
<h2 id="retorno-acumulado-anual">Retorno acumulado anual</h2>
<p>Seleccionamos los precios de cierre ajustados <code>Adj Close</code>
desde el a침o 2010 y calculamos el retorno acumulado anual, seleccionando
el 칰ltimo d칤a h치bil de cada a침o.</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>(df</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a> .loc[<span class="st">&#39;2010&#39;</span>:, <span class="st">&#39;Adj Close&#39;</span>]</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a> .groupby(df.index.year).pct_change().add(<span class="dv">1</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a> .groupby(df.index.year).cumprod().sub(<span class="dv">1</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a> .resample(<span class="st">&#39;YE&#39;</span>).last().T</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><code>BTC-USD</code> (Bitcoin) presenta valores perdidos en los
primeros a침os debido a su regulaci칩n y adopci칩n (ver historia completa
en <a
href="https://en.wikipedia.org/wiki/History_of_bitcoin#2014">Wikipedia</a>).</p>
<figure>
<img src="https://images.datons.ai/C-BILELLO-1/D_etf_returns.png" alt="Retorno acumulado anual de ETFs mostrando valores perdidos en los primeros a침os para Bitcoin">
<figcaption>
F3. Retorno acumulado anual de ETFs
</figcaption>
</figure>
<blockquote>
<p>Ay칰dame a seguir creando m치s tutoriales clicando en el <strong>bot칩n
del aplauso. 춰Gracias!</strong> 游녪</p>
</blockquote>
<h2 id="resumen-por-columnas">Resumen por columnas</h2>
<p>쮺칩mo se comportaron los activos durante todos los a침os?</p>
<p>Calculamos el retorno promedio anual y el retorno acumulado anual
para cada activo.</p>
<blockquote>
<p>Para m치s detalles sobre el c치lculo de los retornos, visita <a
href="https://datons.ai/preprocess-and-analyze-stock-returns-with-python/">este
tutorial</a>.</p>
</blockquote>
<div class="sourceCode" id="cb4"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>t_avg <span class="op">=</span> df.mean(axis<span class="op">=</span><span class="dv">1</span>).mul(<span class="dv">100</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>t_cum <span class="op">=</span> df.add(<span class="dv">1</span>).cumprod(axis<span class="op">=</span><span class="dv">1</span>).sub(<span class="dv">1</span>).mul(<span class="dv">100</span>).iloc[:,[<span class="op">-</span><span class="dv">1</span>]]</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>pd.DataFrame({<span class="st">&#39;AVG&#39;</span>: t_avg, <span class="st">&#39;CAGR&#39;</span>: t_cum})</span></code></pre></div>
<figure>
<img src="https://images.datons.ai/C-BILELLO-1/D_etf_summary.png" alt="Resumen de retorno promedio anual y acumulado de diferentes activos financieros">
<figcaption>
F4. Resumen de retorno de activos financieros
</figcaption>
</figure>
<h2 id="resumen-por-filas">Resumen por filas</h2>
<p>쮺u치les fueron los valores m치ximos y m칤nimos en cada a침o? 쮺u치l fue
el porcentaje de retornos positivos?</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>positive_pct <span class="op">=</span> <span class="kw">lambda</span> x: (x <span class="op">&gt;</span> <span class="dv">0</span>).mean() <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>dfr.agg([<span class="st">&#39;max&#39;</span>, <span class="st">&#39;min&#39;</span>, positive_pct])</span></code></pre></div>
<p>Todos los activos presentan retornos positivos acumulados al final
del per칤odo, siendo <code>BTC-USD</code> el activo con mayor
rentabilidad.</p>
<figure>
<img src="https://images.datons.ai/C-BILELLO-1/D_etf_summary_rows.png" alt="Valores m치ximos, m칤nimos y porcentaje de retornos positivos de activos financieros por a침o">
<figcaption>
F5. Resumen anual de rendimiento de activos financieros
</figcaption>
</figure>
<h2 id="combinar-y-aplicar-estilo">Combinar y aplicar estilo</h2>
<p>Finalmente, combinamos todas las tablas y aplicamos un estilo para
resaltar los valores m치ximos y m칤nimos.</p>
<blockquote>
<p>En <a
href="https://datons.ai/style-pandas-pivot-table-to-create-heat-matrix/">este
tutorial</a> se explica c칩mo aplicar estilos a tablas de pandas.</p>
</blockquote>
<figure>
<img src="https://images.datons.ai/C-BILELLO-1/D_asset_performance.png" alt="Comparaci칩n de rendimiento anual de diferentes activos financieros desde 2010">
<figcaption>
F1. Rendimiento anual de activos financieros desde 2010
</figcaption>
</figure>
<p>쯇or qu칠 durante el a침o 2022 casi todos los activos presentan
retornos negativos?</p>
<p>Te leo en los comentarios.</p>
<h1 id="conclusiones">Conclusiones</h1>
<ol type="1">
<li><strong>Descargar datos hist칩ricos:</strong>
<code>yf.download(tickers)</code> para obtener datos de m칰ltiples
activos financieros de Yahoo Finance.</li>
<li><strong>Calcular el retorno acumulado anual:</strong>
<code>.pct_change().add(1).cumprod().sub(1)</code> para determinar el
rendimiento de un activo a lo largo del tiempo.</li>
<li><strong>Agrupar datos para c치lculos acumulados:</strong>
<code>groupby.cumprod</code> para resetear los c치lculos acumulados al
inicio de cada a침o.</li>
<li><strong>Seleccionar el 칰ltimo d칤a de retorno acumulado:</strong>
<code>.resample('Y').last()</code> para obtener el valor final de cada
a침o, 칰til para an치lisis anual.</li>
<li><strong>Identificar valores m치ximos y m칤nimos:</strong>
<code>.agg(['max', 'min'])</code> para encontrar los extremos en el
rendimiento anual de los activos.</li>
<li><strong>Calcular el porcentaje de retornos positivos:</strong>
<code>lambda x: (x &gt; 0).mean() * 100</code> para evaluar la
frecuencia de ganancias de un activo.</li>
</ol>
<hr />
<blockquote>
<p>Adem치s de este tutorial, puedes aprender m치s con nuestros cursos en
directo.</p>
<p>Te ense침ar칠 las mejores pr치cticas para programar m치s en menos l칤neas
y resolver tus dudas, todo mientras trabajamos en casos pr치cticos sobre
datos que te interesen.</p>
<p>Para m치s informaci칩n, visita <a
href="https://datons.ai/"><strong>datons</strong></a></p>
</blockquote>

</body>
</html>